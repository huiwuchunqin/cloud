<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>学科题型管理</title>
<#include "/manage/common/meta_js.html"/> 
<#include "/manage/common/meta_css.html"/>
<script type="text/javascript" src="/manage/template/comboChange/comboChange.js"></script>
</head>
<body>
<div id="tb">
<div class="labelBox">
	<div class="labelLine240">
	<span class="labelWidth60">学段：</span><input id="section" class="easyui-combobox" data-options="onChange:sectionChange,editable:false,textField:'name',valueField:'code'">
	</div>
	<div class="labelLine240">
	<span class="labelWidth60">学科：</span><input id="subject" class="easyui-combobox" data-options="editable:false,textField:'name',valueField:'code'">
	</div>
</div>
	<div class="btnBox">
		<a class="btn btnBlue add l10" onclick="add()">新增</a>
		<a class="btn btnBlue search" onclick="query()">查询</a>
	</div>
</div>
	<table id="dg" class="easyui-datagrid"
		data-options="
			toolbar:'#tb',
			pagination:true,
			rownumbers:true,
			fit:true,
			singleSelect:true,
			onBeforeLoad:onBeforeLoad,
			url:'/manage/questionTypeSubject/list.html'
         ">
		<thead>
			<tr>
				<th data-options="field:'opt',formatter:delfmt,width:60,halign:'center',align:'center'">操作</th>
				<th data-options="field:'subjectName',width:120,halign:'center',align:'left'">学科</th>
				<th data-options="field:'name',width:120,halign:'center',align:'left'">题型名称</th>
				<th data-options="field:'flagSysEvaluate',formatter:commonfmt,width:110,halign:'center',align:'center'">支持系统批阅</th>
				<th data-options="field:'flagSupportListening',formatter:commonfmt,width:100,halign:'center',align:'center'">支持听力</th>
				<th data-options="field:'textType',formatter:textTypefmt,width:150,halign:'center',align:'center'">主观题默认显示文本</th>
				<th data-options="field:'description',width:120,halign:'center',align:'left'">学科备注</th>
				<th data-options="field:'dispOrder',width:120,halign:'center',align:'right'">排序</th>
			</tr>
		</thead>
	</table>
	<script type="text/javascript">
	var sectionList=eval(${sectionList});
	$(function(){
		$('#section').combobox('loadData',sectionList);
		$('#section').combobox('select',sectionList[0].code);
		query();
	})
	
	function onBeforeLoad(param){
		param["subjectCode"]=$('#subject').combobox('getValue');
		param["sectionCode"]=$('#section').combobox('getValue');
	}
	
	//共通格式化
	function commonfmt(value,row){
		switch(value){
		case "1":return "是";break;
		case "0":return "否";break;
		default:return "";break;
		}
	}
	
	function textTypefmt(value,row){
		var result="";
		if(row.flagSysEvaluate==0){
			if(value==0){
				result="富文本";
			}else{
				result="普通文本";
			}
		}else{
			result="-"
		}
		return result;
	}
	
	//删除
	function delfmt(value,row){
		return "<a href='javascript:void(0)' onclick='del(\""+row.code+"\")'>删除</a>";
	}
	
	function del(code){
		$.messager.confirm("信息","确认要删除吗？",function(r){
			if(r){
				$.ajax({
					url:"/manage/questionTypeSubject/delete.html",
					data:{
						code:code,
					},
					success:function(res){
						alert(res.msg);
						$('#dg').datagrid('reload');
					}
				})
			}
		})
	}
	
	//新增
	function add(){
		easyui_openNoResizeWindow("题型新增",450,420,"/manage/questionTypeSubject/toQuestionTypeAdd.html",function(r){
			 if(r){
				 $('#dg').datagrid('reload');
			 }
		})
	}
	
	//查询
	function query(){
		$('#dg').datagrid('reload');
	}
	
	function sectionChange(record){
		sectionSubject(record,$('#subject'));
	}
	</script>
</body>
</html>