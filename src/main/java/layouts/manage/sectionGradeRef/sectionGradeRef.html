<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<#include "/manage/common/meta_js.html"/> 
<#include "/manage/common/meta_css.html"/>
</head>
<style>
ul{ width:750px;margin-top:20px}
li{width:350px;border-bottom:1px solid #dddddd;padding:5px;    line-height:20px;}
li span{width:80px;overflow:hidden;display:inline-block;margin-left:20px;height:23px;line-height:34px;font-family: "微软雅黑", Helvetica, Arial, sans-serif}
.memo{width:195px}
label{margin-left:5px;color:gray}
</style>
<body >
<div id="tb">
<div class="box">
	<div class="labelLine350">
		<label>设定学段所对应的年级&nbsp;&nbsp;：</label>
		<input class="easyui-combobox"  id="section" data-options="onSelect:onselect,textField:'name',valueField:'code',editable:false">
	</div>
	<div class="btnBox">
		<a class="btn btnBlue"  iconCls="icon-save" onclick="saveSectionGradeRef()">保存</a>
	</div>
</div>
</div>
<table id="dg" class="easyui-datagrid"
	data-options="
   toolbar:'#tb', 
   fit:true,
   rownumbers:true,
    fitColumns:true,
   ">
		<thead>
			<tr>
				<th data-options="field:'ck',checkbox:true,width:80,halign:'center',align:'center'"></th>
				<th data-options="field:'gradeName',halign:'center',width:80,align:'left'">年级名称</th>
				<th data-options="field:'description',width:450,halign:'center',align:'left'">描述</th>
			    <!-- <th data-options="field:'dispOrder',width:120,halign:'center',align:'right',headalign:'center'">显示顺序</th> --> 
			</tr>
		</thead>
	</table>
<!-- <ul id="gradeList" data-bind="foreach:gradeList" >

	<li>
		<input type="checkbox" data-bind="value:gradeCode,checked:(selected==1)">
		<span data-bind="text:gradeName"> </span>
		<span class="memo" data-bind="visible:description"><label data-bind="text:description"></label></span>

	</li>

</ul> -->
<script type="text/javascript">
var sectionList=eval(${sectionList});
$(function(){
	$('#section').combobox('loadData',sectionList);
	if(sectionList.length>0&&sectionList[0].code){
		$('#section').combobox('select',sectionList[0].code);	
	}
	/* bindData([]); */
})
//学段选择事件
function onselect(){
	var sectionCode=$('#section').combobox('getValue');
	var opt={
			url:'/manage/sectionGradeRef/sectionGradeRefSet.html',
			data:{
				sectionCode:sectionCode
				},
			type:'post',
			success:function(json){
				if(json==undefined||json==null||json.length<=0){
					$.messager.alert("信息","没有查询到相关数据","info");
					 $("#dg").datagrid("loadData",[]);
				}else{
					$('#dg').datagrid('loadData',json);
					var result=eval(json);
					$.each(result,function(i,data){
						if(data.selected==1){
							 $("#dg").datagrid("checkRow", i);	
						}
					})	
				}
			
			/* 	var result=eval(json);
				modelView.gradeList(result);
				if(result.length>0){
					$('#tb').show();
				}else{
					$('#tb').hide();	
				} */
			}
	}
	$.ajax(opt);
}
//绑定数据
function bindData(list){
	ko.cleanNode($('#gradeList')[0]);
	modelView={gradeList:ko.observableArray(list)};
	ko.applyBindings(modelView,$('#gradeList')[0])
}
//保存学段年级关系
function saveSectionGradeRef(){							
	var sectionCode=$('#section').combobox('getValue');
	var gradeCodeArray=new Array();
/* 	$("input[type='checkbox']:checked").each(function(){
		gradeCodeArray.push(this.value)
	}) */
	var rows=$('#dg').datagrid('getChecked');
	$.each(rows,function(){
		gradeCodeArray.push(this.gradeCode);
	})
	var opt={
		url:'/manage/sectionGradeRef/sectionGradeRefSave.html',
		data:{
			sectionCode:sectionCode,
			gradeCodeArray:gradeCodeArray,
		},
		type:'post',
		success:function(json){
		$.messager.alert("信息",json.msg,"info");
		}
	}
	$.ajax(opt)
} 
</script>
</body>
</html>