<style type="text/css">
.editingModel{
background:#EEF9FF;
}
.cancel{
background:url("/manage/template/images/cancel.png") no-repeat;
border:0px !important;
width: 30px;
height: 30px;
display: inline-block;
cursor: pointer;
}
.ok{
background:url("/manage/template/images/ok.png") no-repeat;
border:0px !important;
width: 30px;
height: 30px;
display: inline-block;
cursor: pointer;
}
</style>

<div  data-options="region:'north'" style="height:60px;padding:10px 5px" data-bind="css:{editingModel:editing()}">
		<div data-bind="visible:editing()">
			<form id="fm">
				<div class="labelLine240">
				<span class="labelWidth60">学科:</span>
					<input id="addSubject" class="easyui-combobox"
						data-options="required:true,textField:'name',valueField:'code',editable:false">
				</div>
				<div class="labelLine240">
				<span class="labelWidth60">老师:</span>
					<input id="addTeacher" class="easyui-combobox"
						data-options="required:true,textField:'userName',valueField:'teacherCode'">
				</div>
			</form>
			<div class="btnBox">
				<span class="ok"   onclick="save()"> </span>
				<span class="cancel" onclick="cancelEdit()"></span>
			</div>
		</div>

		<div class="align-right" data-bind="visible:!editing()">
			<a class="btn btnBlue add" onclick="add()">新增</a>
		</div>
</div>

<div data-options="region:'center'">
	<table id="classSubjectDg" class="easyui-datagrid">
		<thead>
			<tr>	
				<th
					data-options="field:'subjectName',width:70,halign:'center',align:'left'">学科名称</th>
				<th
					data-options="field:'teacherName',width:110,halign:'center',align:'left'">老师姓名</th>
				<th
					data-options="field:'modifyTime',halign:'center',width:120,align:'center',formatter:timefmt">更新时间</th>
				<th
					data-options="field:'operate',width:80,halign:'center',align:'center',formatter:optfmt">操作</th>
			</tr>
		</thead>
	</table>
</div>
<!-- <div class="align-right">
	<button class="btn btnConfirm search">确定</button>
	<span class="space5"></span>
	<button class="btn btnCancel">取消</button>
</div> -->

<script>


function onBeforeLoad(param) {
	 param["orgCode"]=adminClass.orgCode;
	 param["gradeCode"]=adminClass.gradeCode;
	 param["adminClassCode"]=adminClass.classCode; 
}

//打开新增窗口
function add() {
	
	if(adminClass==null){
		alert("请先保存行政班级信息");
		return false;
	}
	//查询机构学段学科
	orgSectionSubject(sectionCode, $('#addSubject'), true);
	
	//老师 
	var _teacherList=_.clone(teacherList);
		_teacherList.unshift({
			teacherCode : "",
			userName : "请选择"
		});
	$('#addTeacher').combobox('loadData', _teacherList);
	
	model.editing(true);
}



//操作格式化
function optfmt(value, row) {
		return "<a href='javascript:void(0)' onClick='deleteSubjectInfo(\""+row.gid+"\")'>删除</a>"
}

//删除行政班级学科信息
function deleteSubjectInfo(gid){
	var opt={
		url:'/manage/adminClassSubject/deleteAdminClassSubject.html',
		data:{
			gid:gid
		},
		success:function(res){
			if(res.success){
				$('#classSubjectDg').datagrid('reload');
			}
		}
	}
	$.messager.confirm("信息","确认要删除学科信息吗?",function(r){
		if(r){
			$.ajax(opt);
		}
	})
}


//取消新增
function cancelEdit() {
	selectComboFirst($('#addSubject'));
	selectComboFirst($('#addTeacher'))
	model.editing(false);
}



//保存任教信息
function save() {
	var teacherCode = $('#addTeacher').combobox('getValue');
	var teacherName = $('#addTeacher').combobox('getText');
	var subjectCode = $('#addSubject').combobox('getValue');
	$.ajax({
		url : "/manage/adminClass/addAdminClassSubject.html",
		data : {
			orgCode : adminClass.orgCode,
			subjectCode : subjectCode,
			gradeCode : adminClass.gradeCode,
			adminClassCode : adminClass.classCode,
			teacherCode : teacherCode,
			teacherName : teacherName,
			
		},
		success : function(res) {
			$.messager.alert("提示", res.msg, "info",function(){
				if(res.success){
					$('#classSubjectDg').datagrid('reload');
				 	model.editing(false);
				}	
			});
			
		}
	});
}

</script>