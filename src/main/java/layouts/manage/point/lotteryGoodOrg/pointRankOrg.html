<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>积分头衔</title>
<#include "/manage/common/meta_js.html"/> <#include
"/manage/common/meta_css.html"/>
</head>
<body>
	<div id="tb">
		<a class="btn btnBlue add" iconCls="icon-add" 	onclick="add()">新增</a>
	</div>
	<table id="dg" class="easyui-datagrid" data-options="
	pagination:true,
	singleSelect:true,
	rownumbers:true,
	toolbar:'#tb',
	fit:true,
	url:'/manage/orgRank/pageList.html'
	
	">
	<thead>
	<tr>
		<th data-options="field:'opt',width:130,formatter:optfmt,align:'center',halign:'center'">操作</th>
		<th data-options="field:'rankName',width:300,align:'left',halign:'center'">头衔名称</th>
		<th data-options="field:'totalPoint',align:'right',halign:'center'">所需积分</th>
		<th data-options="field:'userRole',formatter:userRolefmt,align:'left',halign:'center'">用户身份</th>
		<th data-options="field:'startTime',formatter:timefmt,align:'center',halign:'center'">版本开始日期</th>
		<!-- <th data-options="field:'expireTime',formatter:timefmt,align:'center'">版本失效日期</th> -->
		<th data-options="field:'memo',width:300,align:'left',halign:'center'">备注</th> 
	</tr>
	</thead>
	</table>
	<script type="text/javascript">
	function find(){
		$('#dg').datagrid('reload');
	}
	//操作格式化
	function optfmt(value,row){
		return "<a href='javascript:void(0)' onclick='edit("+row.id+")'>修改</a>"
		/* +"&nbsp;<a href='javascript:void(0)' onclick='deleteRank("+row.id+")'>删除</a>" */
		
		
	}
	//新增
	function add(){
		easyui_openNoResizeWindow("新增积分头衔等级",500,350,"/manage/orgRank/toPointRankOrgAdd.html",function(r){
			if(r){
				$('#dg').datagrid('reload');
			}
		})
	}
	//修改
	function edit(id){
		easyui_openNoResizeWindow("修改积分头衔等级",500,350,"/manage/orgRank/toPointRankOrgEdit.html?id="+id,function(r){
			if(r){
				$('#dg').datagrid('reload');
			}
		})	
	}
	//时间格式化
	function timefmt(value,row){
		return moment(value,"YYYYMMDDHHmmss").format("YYYY-MM-DD H:mm");
	}
	//用户角色格式化
	function userRolefmt(value,row){
		switch(value){
		case "30":return "管理人员";break;
		case "90":return "系统管理员";break;
		case "10":return "教师";break;
		case "20":return "学生";break;
		case "40":return "家长";break;
		default:break;
	}
		
	}
	//删除
	function deleteRank(id){
		$.messager.confirm("信息","你确认要删除吗？",function(r){
			if(r){
				$.ajax({
					url:"/manage/orgRank/delete.html",
					data:{
						id:id,
					},
					success:function(res){
						$.messager.alert("信息",res.msg,"info",function(){
							if(res.success){
								$('#dg').datagrid('reload');
							}
						})
					}
				})	
			}
		})
	}
	</script>
</body>
</html>