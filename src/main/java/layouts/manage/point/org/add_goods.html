<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>机构_新增礼品页面</title>
<#include "/manage/common/meta_js.html"/>
<#include "/manage/common/meta_css.html"/>
<style type="text/css">.content-box {
	padding: 10px;
}

.content-box:after {
	clear: both;
}
.left-box,.right-box{
	float: left;
}
.content-box .left-box {
	width: 150px;
	height: 150px;
}

.content-box .left-box img {
	/* max-width: 130px;
		max-height: 200px;
		width: auto;
		height: auto; */

}

.content-box .right-box {
	width: 365px;
	margin-left: 20px;
}

.right-box .line-item {
	/*height: 20px;*/
	padding: 5px;
}

.line-item>span {
	display: inline-block;
	width: 60px;
}

.line-item>label {
	cursor: pointer;
}

.line-item>label>input {
	margin-top: 0;
	margin-right: 5px;
	vertical-align: middle;
}
.line-item .numberbox{
	width: 150px !important;
	padding: 0px;
}
.btn-box {
	position: absolute;
	right: 0;
	bottom: 0;
}


.btn-box button:first-child {
	margin-left: 0;
}

.tip {
	position: absolute;
	left: 62px;
	top: 48px;
	width: 31px;
	height: 0px;
	line-height: 21px;
	color: grey;
}
img{
	position:relative
}
</style>
</head>
<body>
	<div class='content-box'>
		<div class='left-box'>
		    <input id="id" name="id" hidden="hidden"/>
		    <input id="goodsThumbnailJson" name="goodsThumbnailJson" hidden="hidden"/>
			<form id="image" enctype="multipart/form-data" method="post" action="/manage/company/uploadImage.html">
			<div>
			<input hidden="hidden" style="width:170px" type="file" name="file" id="file" accept="image/*" />
			<input hidden="hidden" id="fileType" name="fileType" value="gift"/>
			</div>
			<div style="width:150px;position:relative;cursor:pointer;" >
			    <label  class="tip" id="tip">上传图片</label>
				<img id="img" style="height:150px;width:150px;border:0;" />
			</div>
		    </form>
		</div>
		<div class='right-box'>
			<div class='line-item'>
				<span>礼品名称</span>
				<input id="goodsName" class="easyui-validatebox" maxlength="30"
				  data-options="validType:'length[0,30]',required:true"/>
			</div>
			<div class='line-item'>
				<span>所需积分</span>
				<input id="points" class="easyui-numberbox" data-options="min:0,max:10000" name="points" type='number' style="border-color: #FFA8A8"/><span style="margin-left: 5px;">积分</span>
			</div>
			<div class='line-item'>
				<span>礼品单位</span>
				<input id="goodsUnit" class="easyui-validatebox" maxlength="20"
				   data-options="validType:'length[0,20]',required:true"/>
			</div>
			<div class='line-item'>
				<span>显示顺序</span>
				<input id="dispOrder" class="easyui-numberbox" maxlength="10"
				   data-options="min:0,max:100000000,required:true"/>
			</div>
			<div class='line-item'>
			    <span>人群</span>
			    <label>
			    	<input name="userRoleRequirement" type="radio" value="10"/>教师
			    </label>
			    <label>
			    	<input name="userRoleRequirement" type="radio" value="20"/>学生
			    </label>
			    <label>
			    	<input name="userRoleRequirement" type="radio" value="0"/>全部
			    </label>
			</div>
			<div class='btn-box'>
				<button class="btn btnConfirm" onclick="save()">确定</button>
				<button class="btn btnCancel" onclick="cancel()">取消</button>
			</div>
		</div>
		<div style="float:none;clear:both;"></div>
	</div>
	
	<script type="text/javascript">
	var gift=eval(${orgGift});
	var filePath="";
	$(function(){
		imageUpload($('#file'),$('#img'),function(coverpath){
			filePath=coverpath;
		})
		if(gift){
			$('#goodsName').val(gift.goodsName);
			$('#points').numberbox('setValue',gift.points);
			$('#goodsUnit').val(gift.goodsUnit);
			$('#dispOrder').numberbox('setValue',gift.dispOrder);
			$("input[name='userRoleRequirement'][value='"+gift.userRoleRequirement+"']").attr("checked","checked");
			if(gift.goodsThumbnailJson){
				//隐藏上传图片文字提示
				$("#tip").html("");
				$('#img').attr("src","${imgHost}/"+gift.goodsThumbnailJson);
			}
			$('#goodsThumbnailJson').val(gift.goodsThumbnailJson);
			$('#id').val(gift.id);
		}
		
	})
	
    //取消
    function cancel(){
    	easyui_closeTopWindow(false);
    }
	
    //保存
    function save(){
            	var points=$('#points').numberbox('getValue');
            	var userRoleRequirement=$("input[name='userRoleRequirement']:checked").val();
            	var goodsName=$('#goodsName').val();
            	var goodsUnit=$('#goodsUnit').val();
            	var dispOrder=$('#dispOrder').numberbox('getValue');
            	if(points==null||points==""){
            		$.messager.alert('消息','所需积分不能为空！','info');
                    return;
            	}
                if(points=="0"){
                	$.messager.alert('消息','所需积分不能为0！','info');
                    return;
                }
                //小数正则表达式
                var patten = /^-?\d+\.\d+$/;
                var bol = patten.test(points);
                if(bol){
                	$.messager.alert('消息','所需积分不能为小数！','info');
                    return;
                }
            	if(userRoleRequirement==null||userRoleRequirement==""){
            		$.messager.alert('消息','面向人群不能为空！','info');
                    return;
            	}
            	if(goodsName==null||goodsName==""){
            		$.messager.alert('消息','礼品名称不能为空！','info');
                    return;
            	}
            	if(goodsUnit==null||goodsUnit==""){
            		$.messager.alert('消息','礼品单位不能为空！','info');
                    return;
            	}
            	if(dispOrder==null||dispOrder==""){
            		$.messager.alert('消息','显示顺序不能为空！','info');
            		return;
            	}
        		var opts={
        				url:'/manage/point/org/addOrgGift.html',
            			type:"post",
        				data:{
        					goodsName:goodsName,
        					userRoleRequirement:userRoleRequirement,
        					points:points,
        					goodsUnit:goodsUnit,
        					dispOrder:dispOrder,
        					id:$('#id').val(),
        					goodsThumbnailJson:$('#goodsThumbnailJson').val(),
        				},
        				success:function(res){
        					window.top.$.messager.alert("提示", res.msg, "info");
    						if(res.success){
    							easyui_closeTopWindow(true);
    						}
        				 },
        				error:function(XMLHttpRequest, textStatus, errorThrown) {
        						alert("网络繁忙请稍后再试");
        				 },
        				complete:function() {
        						
        				}
        				}
        		if(filePath){
        			opts.data.goodsThumbnailJson=filePath;
        		}
        			$.ajax(opts)
    }

    </script>
</body>
</html>