<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<#include "/manage/common/meta_js.html"/> 
<#include "/manage/common/meta_css.html"/>
<title>用户信息</title>
</head>
<body class="easyui-layout">
	<div data-options="region:'north'" style="height: 35px">
		<div class="labelBox" style="margin-top: 6px; margin-left: 10px">
			<!-- <span style="width: 280px; float: left;"><span
				class="labelWidth60" style="line-height: 20px">用户身份</span><input
				id="userRole" class="easyui-combobox"
				data-options="textField:'name',valueField:'value',editable:false,
	                data:[{name:'全部',value:'',selected:true},
	                {name:'教师',value:'10'},
	                {name:'学生',value:'20'},
	                {name:'管理人员',value:'30'},
	                {name:'家长',value:'40'},
	                {name:'系统管理员',value:'90'}
	                ]"></span> -->
			<span style="width: 280px; float: left;"><span
				class="labelWidth60" style="line-height: 20px">用户姓名</span><input
				id="userName"/></span>
			<span style="width: 280px; float: left;"><span
				class="labelWidth60" style="line-height: 20px">登录账号</span><input
				id="loginAccount"/></span>
		</div>
		<div class="btnBox">
			<a id="btnSearch" class="easyui-linkbutton" style="margin-top: 6px;margin-right: 10px;" data-options="iconCls:'icon-search'" onclick="query()"><img src="/manage/template/images/search.png">查询</a>
		</div>
	</div>
	<div data-options="region:'center'">
		<table id="dg" class="easyui-datagrid"
			data-options="
			pagination:true,
			fit:true,
			url:'/manage/user/search.html',
			rownumbers:true,
			onBeforeLoad:dgonBeforeLoad,
			singleSelect:true
            ">
			<thead>
			    <tr>
				<th data-options="field:'detail',halign:'center',align:'center',width:130,formatter:detailfmt">操作</th>
				<th data-options="field:'userName',halign:'center',align:'left',width:120">用户姓名</th>
				<th data-options="field:'loginAccount',halign:'center',align:'left',width:120">登录账号</th>
				<th data-options="field:'status',halign:'center',align:'center',width:120,formatter:statusfmt">状态</th>
				<th data-options="field:'userRole',halign:'center',align:'left',width:120,formatter:rolefmt">用户身份</th>
				<th data-options="field:'gender',width:70,halign:'center',align:'center',formatter:genderfmt">性别</th>
				<th data-options="field:'birthday',width:120,halign:'center',align:'center'">出生年月</th>
				<th data-options="field:'mobile',halign:'center',width:100,align:'center'">手机号</th>
				<th data-options="field:'userCode',width:90,hidden:true">userCode</th> 
                </tr>
			</thead>
		</table>
	</div>
	<script type="text/javascript">
		function dgonBeforeLoad(param) {
			//param["userRole"] = $('#userRole').combobox('getValue');
			param["loginAccount"] = $('#loginAccount').val();
			param["userName"] = $('#userName').val();
		}
		
		function query() {
			$('#dg').datagrid('reload');
		}
		
		//状态格式化 
		function statusfmt(value, row) {
			if (value == 0) {
				return "无效";
			}else if (value == 1) {
				return "有效";
			}else if (value == 2) {
				return "锁定";
			}else{
				return "";
			}
		}
		
		//用户身份格式化 
		function rolefmt(value, row) {
			if (value == 10) {
				return "教师";
			}else if (value == 20) {
				return "学生";
			}else if (value == 30) {
				return "管理人员";
			}else if (value == 40) {
				return "家长";
			}else if (value == 90){
				return "系统管理员";
			}else{
				return "";
			}
		}
        
		//性别格式化
		function genderfmt(value,row){
			if(value==0){
				return "女";
			}
			else if(value==1){
				return "男";
			}
			else{
				return "";
			}
		}
		
		function detailfmt(value, row) {
			if (row.userRole == 10 || row.userRole == 20) {
				return "<a href='javascript:void(0)' onclick='detail(this)'>详情</a>"
			}
		}
		
		function detail(object) {
			var index = $(object).closest("tr").index();
			$('#dg').datagrid('selectRow', index);
			var row = $('#dg').datagrid('getSelected');
			if (row.userRole == 10) {
				easyui_openTopWindow("教师信息查看", 630, 470,
						'/manage/user/getTeacherInfo.html?teacherCode='
								+ row.userCode, function() {

						})
			} else if (row.userRole == 20) {
				easyui_openTopWindow("学生信息查看", 630, 470,
						'/manage/user/getStudentInfo.html?studentCode='
								+ row.userCode, function() {

						})
			} else {
				$.messager.alert("信息", "只有身份为学生或教师的用户可以查看详细信息", "info")
			}

		}
		
	</script>
</body>
</html>