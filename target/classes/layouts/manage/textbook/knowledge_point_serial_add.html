<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>知识体系新增</title>
<#include "/manage/common/meta_js.html"/>
<#include "/manage/common/meta_css.html"/>
<script type="text/javascript" src="/manage/template/comboChange/comboChange.js"></script>
<script type="text/javascript" src="/manage/template/helper/helper.js"></script>
<style type="text/css">
	.labelLine300,.labelLine600{
		margin: 10px 0;
	}
	#btnSave{
		color: #fff;
	}
</style>
</head>
<script type="text/javascript">
var kpSerialCode="${kpSerialCode}";
$(function(){
	if(kpSerialCode!=""){
		$('#cc').layout('panel','north').hide();
		$('#cc').layout('remove','north');	
	}	
})
</script>
<body>
<div id="cc" class="easyui-layout" data-options="fit:true">
	<div data-options="region:'north'" style="title:'查询条件'">
		<div  id="addDiv" class="box form" >
					<div class="labelLine300">
						<div class="labelWidth60">学段<span class="required">*</span></div>
						<input class="easyui-combobox" id="section" data-options="
							valueField: 'code',
							textField: 'name',
							panelHeight: 'auto',
							editable: false,
							data: [
								{code: '',name: '请选择',selected:true}
								<#if (sectionList?exists && sectionList?size>0)>
							  		<#list sectionList as section>
							  			,{code:'${section.code}', name:'${section.name?default('&nbsp;')}'}
							  		</#list>
								</#if>
							],onSelect:sectionSelect"/>
					</div>
						<!-- 学科 -->
					<div class="labelLine300">
						<div class="labelWidth60">学科<span class="required">*</span></div>
						<input class="easyui-combobox" id="subject" data-options="
							valueField: 'code',
							textField: 'name',
							panelHeight: 'auto',
							editable: false,
							data: [{code: '',name: '请选择',selected:true}],
							onSelect:subjectSelect
							"/>
					</div>
					<!-- 年级 -->
					<div class="labelLine300">
						<div class="labelWidth60">年级</div>
						<input class="easyui-combobox" id="grade" data-options="
							valueField: 'code',
							textField: 'name',
							panelHeight: 'auto',
							editable: false,
							data: [{code: '',name: '请选择',selected:true}],						
							"/>
					</div>
									
					<!-- 教材版本 -->
					<div class="labelLine300">
						<div class="labelWidth60">教材版本</div>
						<input class="easyui-combobox" id="version" data-options="
							valueField: 'code',
							textField: 'name',
							panelHeight: 'auto',
							editable: false,
							data: [{code:'',name: '请选择',selected:true}],
							onSelect:textbookVerSelect							
							"/>
					</div>
						<!-- 教材 -->
					<div class="labelLine300">
						<div class="labelWidth60">教材</div>
						<input class="easyui-combobox" id="textbook" data-options="
							valueField: 'tbCode',
							textField: 'tbName',
							panelHeight: 'auto',
							editable: false,
							data: [{tbCode:'',tbName: '请选择',selected:true}]							
							"/>
					</div>
						<!-- 学期 -->
					<div class="labelLine300">
						<div class="labelWidth60">学期</div>
						<input class="easyui-combobox" id="term" data-options="
							valueField: 'code',
							textField: 'name',
							panelHeight: 'auto',
							editable: false,
							data: [
							{code:'',name: '请选择',selected:true},
							{code:'1',name: '上学期'},
							{code:'2',name: '下学期'},
							]"/>
					</div>
			</div>
	
		<form id="fm" method="post" onsubmit="checkForm()">
		<div class="box form">
			<div class="labelBox">
				<div class="labelLine600">
					<span class="labelWidth60">知识体系名称<span class="required">*</span></span>
					<input class="easyui-validatebox" id="name" name="name" data-options="required:true" maxlength="40" placeholder="请输入知识点名称" value=""/>
				</div>
				<div class="labelLine600">
					<span class="labelWidth60">备注</span>
					<textarea class="easyui-validatebox " rows="5" cols="50" id="description" name="description" maxlength="40"></textarea>
				</div>
			</div>
		</div>
		</form>
	</div>
	<div data-options="region:'south',border:false" style="text-align: right; padding:0 10px 10px 0;">
				<a class="btn btnBlue" id="btnSave"href="javascript:void(0);" onclick="save()">保存</a>
				<a class="btn btnGrey" style="margin-left: 5px;" id="btnCancel"   onclick="closeWindow()"href="javascript:void(0);">关闭</a>
	</div>
</div>	
	<script type="text/javascript">
	
	//学段选择事件
	function sectionSelect(record){
		sectionGrade(record.code,$('#grade'));
		sectionSubject(record.code,$('#subject'));
		$('#textbook').combobox('clear');
		$('#textbook').combobox('loadData',[{tbName:"请选择",tbCode:""}]);
	}
	//年级选择事件
	function gradeSelect(record){
		gradeSubject(record.code,$('#subject'));
		$('#textbook').combobox('clear');
		$('#textbook').combobox('loadData',[{tbName:"请选择",tbCode:""}]);
	}
		//学科选择事件
	function subjectSelect(record){
		subjectTextbookVer(record.code,$('#version'));
		$('#textbook').combobox('clear');
		$('#textbook').combobox('loadData',[{tbName:"请选择",tbCode:""}]);
		
	}
		//教材版本选择事件
	function textbookVerSelect(record){
		var sectionCode=$("#section").combobox('getValue');
		var subjectCode=$("#subject").combobox('getValue');
		var gradeCode=$("#grade").combobox('getValue');
		textbookVerTextbook(sectionCode,subjectCode,gradeCode,record.code,$('#textbook'))
	}
	function closeWindow(){
		easyui_closeTopWindow(false);
	}
	//保存
	var sectionCode="";
	var subjectCode="";
	var gradeCode="";
	var versionCode="";
	var termCode="";
	var textbookCode="";
	function save(){
		if(kpSerialCode==""){
			 sectionCode=$("#section").combobox('getValue');
			 subjectCode=$("#subject").combobox('getValue');
			 gradeCode=$("#grade").combobox('getValue');
			 versionCode=$("#version").combobox('getValue');
			 termCode=$("#term").combobox('getValue');
			 textbookCode=$('#textbook').combobox('getValue');
			if(isEmpty(sectionCode)){
				alert("请选择学段");
				return ;
			}	
			if(isEmpty(subjectCode)){
				alert("请选择学科");
				return ;
			}
		/* 	if(isEmpty(gradeCode)){
				alert("请选择年级");
				return ;
			}
			if(isEmpty(versionCode)){
				alert("请选择教材版本");
				return ;
			}
			if(isEmpty(termCode)){
				alert("请选择学期 ");
				return ;
			}
			if(isEmpty(textbookCode)){
				alert("请选择教材 ");
				return ;
			}	 */
		}
	
		var name=$('#name').val();
		var description=$('#description').val();
		if($('#fm').form('validate')){
			$.ajax({
				url:'/manage/knowledgeSerial/addKnowledgeSerial.html',
				data:{
					sectionCode:sectionCode,
					gradeCode:gradeCode,
					subjectCode:subjectCode,
					textbookVerCode:versionCode,
					termCode:termCode,
					textbookCode:textbookCode,
					name:name,
					memo:description,
					kpSerialCode:kpSerialCode,
				},
				type:'post',
				success:function(res){
					$.messager.alert("信息",res.msg,"info",function(){
						easyui_closeTopWindow(res.data);	
					})
				}
			})	
		}
	}
	</script>
</body>
</html>