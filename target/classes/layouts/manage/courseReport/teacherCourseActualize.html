<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>教师课程实施情况统计</title> <#include "/manage/common/meta_js.html"/>
<#include "/manage/common/meta_css.html"/>
</head>
<body class="easyui-layout">
	<div data-options="region:'north'" >
		<div class="box">
			<div id="paramBox" class="labelBox">
				<div class="labelLine400">
					<span class="labelWidth60">创建日期：</span> <input id="startDate"
																   class="Wdate"
																   onfocus="WdatePicker({maxDate:'#F{$dp.$D(\'endDate\')}',dateFmt:'yyyy-MM-dd'})" />
					~ <input id="endDate" class="Wdate"
							 onfocus="WdatePicker({minDate:'#F{$dp.$D(\'startDate\')}',dateFmt:'yyyy-MM-dd'})" /> 
				</div>
				<div class="labelLine400">
					<span class="labelWidth60">实施日期：</span> <input id="publishStartDate"
																   class="Wdate"
																   onfocus="WdatePicker({maxDate:'#F{$dp.$D(\'publishEndDate\')}',dateFmt:'yyyy-MM-dd'})" />
					~ <input id="publishEndDate" class="Wdate"
							 onfocus="WdatePicker({minDate:'#F{$dp.$D(\'publishStartDate\')}',dateFmt:'yyyy-MM-dd'})" /> 
				</div>
				<span class="clear10"></span>
				<div class="labelLine240">
					<span class="labelWidth60">学期</span> <input id="yearTermCode" class="easyui-combobox"
																data-options="textField:'yearTermName',valueField:'yearTermCode',editable:false">
				</div>
				<div class="labelLine240">
					<span class="labelWidth60">学段：</span> <input id="sectionCode"
																 class="easyui-combobox"
																 data-options="onChange:sectionChange,textField:'name',valueField:'code',editable:false">
				</div>
				<div class="labelLine240">
					<span class="labelWidth60">学科：</span> <input id="subjectCode"
																 class="easyui-combobox"
																 data-options="textField:'name',valueField:'code',editable:false,data:[{name:'请选择',code:''}]">
				</div>
				<span class="clear10"></span>
				<div class="labelLine240">
					<span class="labelWidth60">作者：</span> <input id="teacherName"
																 placeholder="请输入教师名称">
				</div>
				<div class="labelLine240">
					<span class="labelWidth60">学校：</span> <input id="orgName"
																 placeholder="请输入学校名称">
				</div>
			</div>
			<div class="btnBox">
				<a class="btn btnBlue" onclick="query()">查询</a>
			</div>
		</div>
	</div>
	<div data-options="region:'center'">
		<div id="tb" class="tbClass">
			<div class="attr">
				<span>人数：</span> <label id="teacherTotal"></label>
			</div>
			<div class="attr">
				<span>课程总数：</span> <label id="lessonTotal"></label>
			</div>
			<div class="attr">
				<span>班级课程发布数：</span> <label id="publishTotal"></label>
			</div>
			<div class="attr">
				<span>班级课程实施数：</span> <label id="finishTotal"></label>
			</div>
			<button class="btn btnBlue align-right" onclick="exportData()">导出</button>
		</div>

		<table id="dg" class="easyui-datagrid"
			data-options="
		pagination:true,
		rownumbers:true,
		toolbar:'#tb',
		fit:true,
		onBeforeLoad:onBeforeLoad,
		onLoadSuccess:onLoadSuccess,
		url:'/manage/teacherCourseActualize/search.html'
		">
			<thead>
				<tr>
					<th data-options="field:'teacherName',halign:'center',width:90">姓名</th>
					<th data-options="field:'orgName',halign:'center',width:150">学校</th>
					<th
						data-options="field:'lessonNum',halign:'center',width:90,align:'right'">课程数</th>
					<th
						data-options="field:'flipLessonNum',halign:'center',width:120,align:'right'">翻转课堂模式</th>
					<th
						data-options="field:'autonomousLessonNum',halign:'center',width:120,align:'right'">自主创建模式</th>
					<th
						data-options="field:'publishNum',halign:'center',width:120,align:'right'">班级课程发布数</th>
					<th
						data-options="field:'finishNum',halign:'center',width:120,align:'right'">班级课程实施数</th>
					<th
						data-options="field:'detail',halign:'center',width:90,align:'center',formatter:detailfmt">查看</th>
				</tr>
			</thead>
		</table>
	</div>
	<script type="text/javascript">
var yearTermList=eval(${yearTermList});
var sectionList=eval(${sectionList});
sectionList.unshift({name:"全部",code:""});
yearTermList.unshift({yearTermName:"全部",yearTermCode:""});
$(function(){
	$('#yearTermCode').combobox('loadData',yearTermList);
	$('#sectionCode').combobox('loadData',sectionList);
})

function onBeforeLoad(param){
	$.extend(param,getparam());
	
}

function query(){
	$('#dg').datagrid('reload');
}

function getparam(){
	var param=getParam("paramBox");
	if(param.endDate==""){
		param.endDate=moment().format("YYYY-MM-DD");
	}
	/* if(param.publishEndDate==""){
		param.publishEndDate=moment().format("YYYY-MM-DD");
	} */
	return param;
}
function sectionChange(newValue,oldValue){
	sectionSubject(newValue,$('#subjectCode'))
}
//加载成功 
function onLoadSuccess(){
	var param=getparam();
	$.ajax({
		url:'/manage/teacherCourseActualize/searchTotal.html',
		data:param,
		success:function(res){
			$('#finishTotal').html(res.finishTotal||0);
			$('#publishTotal').html(res.publishTotal||0);
			$('#teacherTotal').html(res.teacherTotal||0);
			$('#lessonTotal').html(res.lessonTotal||0);
		}
	})
}
function detailfmt(value,row){
	return "<a href='javascript:void(0)' onclick='detail(this)'>详情</a>" 
}

function detail(object){
	var index=$(object).closest("tr").index();
	$('#dg').datagrid('selectRow',index);
	var row=$('#dg').datagrid('getSelected');
	var param=$.extend(getparam(),row);
	var iframe=window.top.$('<iframe width="100%" height="100%" scrolling="no" frameborder="0"  id="teacherCourseActualizefm" src="/manage/teacherCourseActualize/toDetail.html"></iframe>');
	iframe.data('param',param);
	window.top.$('#tab').tabs('close',"教师课程实施详情")
	window.top.$('#tab').tabs('add',{
		title:"教师课程实施详情",
		content:iframe,
		closable:true,  
	})
/* 	easyui_openTopWindow("详情",1300,600,"/manage/courseChapter/detailList.html",function(r){
		
	},param) */	
}
//导出数据
function exportData(){
	var param=getparam();
	param.fileName=getExportName();
   downloadHelper(urlWithParam('/manage/teacherCourseActualize/export.html',param))	
	
}

</script>
</body>
</html>