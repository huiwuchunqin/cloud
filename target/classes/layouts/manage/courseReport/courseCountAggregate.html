<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<#include "/manage/common/meta_js.html"/> <#include
"/manage/common/meta_css.html"/>
<title>数量汇总统计</title>
</head>
<body class="easyui-layout">
	<div data-options="region:'north'">
		<div class="box">
			<div class="labelBox">
				<div class="labelLine440">
					<span class="labelWidth60">日期：</span> <input id="startDate"
																 class="Wdate"
																 onfocus="WdatePicker({maxDate:'#F{$dp.$D(\'endDate\')}',dateFmt:'yyyy-MM-dd'})" />
					~ <input id="endDate" class="Wdate"
							 onfocus="WdatePicker({minDate:'#F{$dp.$D(\'startDate\')}',dateFmt:'yyyy-MM-dd'})" />
				</div>
			</div>
			<div class="btnBox">
				<button class="btn btnBlue search" onclick="javascript:$('#dg').datagrid('reload')">查询</button>  
			</div>
		</div>
	</div>
	<div data-options="region:'center'">
		<div id="tb" class="tbClass" >
			<span class="attr"><span>课程数：</span><label id="totalLesson"></label></span> <span
				class="attr"><span>翻转课堂模式：</span><label id="flipLessonTotal"></label></span> <span
				class="attr"><span>自主创建模式：</span><label id="autonomousLessonTotal"></label></span> <span
				class="attr"><span>个人私有数：</span><label id="privateTotal"></label></span> <span
				class="attr"><span>校内共享数：</span><label id="orgTotal"></label></span> <span
				class="attr"><span>区域共享数：</span><label id="areaTotal"></label></span>
				<button class="btn btnBlue align-right" onclick="exportExcel()">导出</button>
		</div>
		<table id="dg" class="easyui-datagrid" data-options="
		fit:true,
		toolbar:'#tb',
		rownumbers:true,
		onBeforeLoad:onBeforeLoad,
		onLoadSuccess:onLoadSuccess,
		singleSelect:true,
		url:'/manage/courseAggregate/search.html',
		">
		<thead>
			<tr>
				<th data-options="field:'lessonMode',halign:'center',align:'right',width:100">创建类型</th>
				<th data-options="field:'privateNum',halign:'center',align:'center',width:100">个人私有数</th>
				<th data-options="field:'orgNum',halign:'center',align:'center',width:100">校内共享数</th>
				<th data-options="field:'areaNum',halign:'center',align:'center',width:100">区域共享数</th>
				<th data-options="field:'totalNum',halign:'center',align:'center',width:100">总数</th>
			</tr>
		</thead>
		</table>
	</div>
	
	<script type="text/javascript">
	function onBeforeLoad(param){
		var endDate=$('#endDate').val();
		if(endDate==""){
			endDate=moment().format("YYYY-MM-DD")
		}
		param["startDate"]=$('#startDate').val();
		param["endDate"]=endDate;
	}
	
	function onLoadSuccess(){
		$.ajax({
			url:"/manage/courseAggregate/searchTotal.html",
			data:{
				startDate:$('#startDate').val(),
				endDate:$('#endDate').val()||moment().format("YYYY-MM-DD"),
			},
			success:function(res){
				$('#flipLessonTotal').html(res.flipLessonTotal||0);
				$('#autonomousLessonTotal').html(res.autonomousLessonTotal||0);
				$('#privateTotal').html(res.privateTotal||0);
				$('#orgTotal').html(res.orgTotal||0);
				$('#totalLesson').html(res.totalLesson||0);
				$('#areaTotal').html(res.areaTotal||0);
			 }
		})
	}
	function exportExcel(){
		var startDate=$('#startDate').val();
		var endDate=$('#endDate').val()||moment().format("YYYY-MM-DD");
		downloadHelper("/manage/courseAggregate/export.html?fileName="+getExportName()+"&startDate="+startDate+"&endDate="+endDate);
	}
	</script>
</body>
</html>