<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>课程章节</title> 
<#include "/manage/common/meta_js.html"/>
<#include "/manage/common/meta_css.html"/>
</head>
<body class="easyui-layout" fit="true">
	<div data-options="region:'north'" >
		<div class="box">
			<div class="labelBox">
				<div class="labelLine240">
					<span class="labelWidth60">学段：</span>
					<input id="section" class="easyui-combobox" data-options="textField:'name',valueField:'code',editable:false,onChange:sectionChange">
				</div>

				<div class="labelLine240">
					<span class="labelWidth60">学科：</span>
					<input id="subject" class="easyui-combobox" data-options="data:[{name:'请选择',code:''}],onChange:subjectChange,textField:'name',valueField:'code',editable:false">
				</div>
				<div class="labelLine240">
					<span class="labelWidth60">年级：</span>
					<input id="grade" class="easyui-combobox" data-options="data:[{name:'请选择',code:''}],textField:'name',valueField:'code',editable:false">
				</div>

				<div class="labelLine240">
					<span class="labelWidth60">教材版本：</span>
					<input id="tbv" class="easyui-combobox" data-options="data:[{name:'请选择',code:''}],textField:'name',valueField:'code',editable:false">
				</div>
			</div>
			<div class="btnBox">
				<button class="btn btnBlue search" onclick="javascript:$('#dg').datagrid('reload')">查询</button>
			</div>
		</div>
	</div>
	<div data-options="region:'center'" >
		<div id="tb" class="tbClass" >
		<button class="btn btnBlue align-right" onclick="exportData()">导出</button>
		</div>
		<table id="dg" class="easyui-datagrid" data-options="
		fit:true,
		toolbar:'#tb',
		pagination:true,
		rownumbers:true,
		onBeforeLoad:onBeforeLoad,
		url:'/manage/courseChapter/search.html',
		">
		<thead>
			<tr>
				<th data-options="field:'sectionName',halign:'center',align:'center',width:80">学段</th>
				<th data-options="field:'subjectName',halign:'center',width:100">学科</th>
				<th data-options="field:'gradeName',halign:'center',width:80">年级</th>
				<th data-options="field:'tbName',halign:'center',width:200">教材名称</th>
				<th data-options="field:'tbvName',halign:'center',width:120">教材版本</th>
				<th data-options="field:'chapterNum',halign:'center',align:'center',width:80">章节节点数</th>
				<th data-options="field:'lessonNum',halign:'center',align:'center',width:80">课程数</th>
				<th data-options="field:'lessonCoverage',halign:'center',align:'center',formatter:pecentfmt,width:100">课程覆盖率</th>
				<th data-options="field:'detail',width:80,halign:'center',align:'center',formatter:detailfmt">查看</th>
			</tr>
		</thead>
		</table>
	</div>
	<script type="text/javascript">
	$(function(){
		var sectionList=eval(${sectionList});
		sectionList.unshift({name:"全部",code:"",selected:true});
		$('#section').combobox('loadData',sectionList);
		
	})
	function onBeforeLoad(param){
		param=$.extend(param,getParam());
	}
	
	function detailfmt(value,row){
		return "<a href='javascript:void(0)' onclick='detail(this)'>详情</a>"
	}
	
	function getParam(){
		return{
			sectionCode:$('#section').combobox('getValue'),
			gradeCode:$('#grade').combobox('getValue'),
			tbvCode:$('#tbv').combobox('getValue'),
			subjectCode:$('#subject').combobox('getValue'),
		}
	}
	function detail(object){
		var index=$(object).closest("tr").index();
		$('#dg').datagrid('selectRow',index);
		var row=$('#dg').datagrid('getSelected');
		if(row.chapterNum==0){
			window.top.$.messager.alert("提示", "当前教材下没有教材章节，无法查看详情！", "info");
			return;
		}
		var param={
			sectionCode:row.sectionCode,
			gradeCode:row.gradeCode ,
			subjectCode:row.subjectCode,
			sectionName:row.sectionName,
			gradeName:row.gradeName,
			subjectName:row.subjectName,
			tbvCode:row.tbvCode,
			tbvName:row.tbvName,
			tbCode:row.tbCode,
			chapterNum:row.chapterNum,
			lessonNum:row.lessonNum,
			lessonCoverage:row.lessonCoverage,
				
		};
		var iframe=window.top.$('<iframe width="100%" height="100%" scrolling="no" frameborder="0"  id="courseChapterfm" src="/manage/courseChapter/detailList.html"></iframe>');
		iframe.data('param',param);
		window.top.$('#tab').tabs('close',"课程章节统计详情")
		window.top.$('#tab').tabs('add',{
			title:"课程章节统计详情",
			content:iframe,
			closable:true,  
		})
	/* 	easyui_openTopWindow("详情",1300,600,"/manage/courseChapter/detailList.html",function(r){
			
		},param) */	
	}
	
	function sectionChange(newValue, oldValue){
		sectionSubject(newValue,$('#subject'));
		sectionGrade(newValue,$('#grade'));
	}
	function subjectChange(newValue,oldValue){
		subjectTextbookVer(newValue,$('#tbv'))
	}
	
	function exportData(){
		var href="/manage/courseChapter/export.html?fileName="+getExportName();
	    downloadHelper(urlWithParam(href,getParam())); 		
	}
	</script>
</body>
</html>