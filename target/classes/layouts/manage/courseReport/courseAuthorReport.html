<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>按作者统计</title>
<#include "/manage/common/meta_js.html"/>
<#include "/manage/common/meta_css.html"/>
</head>
<body class="easyui-layout" data-options="fit:true">
	<div data-options="region:'north'">
		<div class="box">
			<div class="labelBox">
				<div class="labelLine440">
					<span class="labelWidth60">日期：</span>
					<input id="startDate" class="Wdate" onfocus="WdatePicker({maxDate:'#F{$dp.$D(\'endDate\')}',dateFmt:'yyyy-MM-dd'})" />
					~ <input id="endDate" class="Wdate" onfocus="WdatePicker({minDate:'#F{$dp.$D(\'startDate\')}',dateFmt:'yyyy-MM-dd'})" />
				</div>
				<span class="clear10"></span>
				<div class="labelLine240">
					<span class="labelWidth60">共享级别：</span>
					<input id="shareLevel" class="easyui-combobox" data-options="textField:'name',valueField:'value',editable:false"> 
				</div>
				<div class="labelLine240">
					<span class="labelWidth60">学段：</span> 
					<input id="section" class="easyui-combobox" data-options="onChange:sectionChange,textField:'name',valueField:'code',editable:false">
				</div>
				<div class="labelLine240">
					<span class="labelWidth60">学科：</span>
					<input id="subject"class="easyui-combobox" data-options="textField:'name',valueField:'code',editable:false,data:[{name:'请选择',code:''}]">
				</div>
				<span class="clear10"></span>
				<div class="labelLine240">
					<span class="labelWidth60">作者：</span>
					<input id="userName" placeholder="请输入作者姓名">
				</div>
				<div class="labelLine240">
					<span class="labelWidth60">学校：</span>
					<input id="schoolName" placeholder="请输入学校名称">
				</div>
			</div>
			<div class="btnBox">
				<button class="btn btnBlue search" onclick="javascript:$('#dg').datagrid('reload')">查询</button>
			</div>
		</div>
	</div>
	<div data-options="region:'center'" data-options="fit:true">
		<div id="tb" class="tbClass" style="height:30px">
			<span class="attr"><span>作者数：</span><label id="teacherTotal"></label></span>
			<span class="attr"><span>课程数：</span><label id="lessonTotal"></label></span>
			<span class="attr"><span>翻转课堂模式：</span><label id="flipLessonTotal"></label></span>
			<span class="attr"><span>自主创建模式：</span><label id="autonomousLessonTotal"></label></span>
			<button class="btn btnBlue align-right" onclick="exportExcel()">导出</button>
		</div>
		<table id="dg" class="easyui-datagrid" data-options="
		fit:true,
		toolbar:'#tb',
		rownumbers:true,
		onBeforeLoad:onBeforeLoad,
		onLoadSuccess:onLoadSuccess,
		pagination:true,
		singleSelect:true,
		url:'/manage/courseAuthor/search.html',
		">
		<thead>
			<tr>
				<th data-options="field:'teacherName',halign:'center',width:100">姓名</th>
				<th data-options="field:'orgName',halign:'center',width:180">学校</th>
				<th data-options="field:'lessonNum',align:'center',halign:'center',width:80">课程数</th>
				<th data-options="field:'flipLessonNum',align:'center',halign:'center',width:100">翻转课堂模式</th>
				<th data-options="field:'autonomousLessonNum',align:'center',halign:'center',width:100">自主创建模式</th>
			</tr>
		</thead>
		</table>
	</div>
		<script type="text/javascript">
	$(function(){
	var sectionList=eval(${sectionList});
	sectionList.unshift({name:"全部",code:""});
	$('#shareLevel').combobox('loadData',_SHARELEVEL);
	$('#section').combobox('loadData',sectionList)
	})
	function onBeforeLoad(param){
		$.extend(param,getParam());
	}
	
	function onLoadSuccess(){
		$.ajax({
			url:"/manage/courseAuthor/searchTotal.html",
			data:getParam(),
			success:function(res){
				$('#teacherTotal').html(res.teacherTotal||0);
				$('#lessonTotal').html(res.lessonTotal||0);
				$('#flipLessonTotal').html(res.flipLessonTotal||0);
				$('#autonomousLessonTotal').html(res.autonomousLessonTotal||0);
			 }
		})
	}
	function getParam(){
		return{
			startDate:$('#startDate').val(),
			endDate:$('#endDate').val()||moment().format("YYYY-MM-DD"),
			shareLevel:$('#shareLevel').combobox('getValue'),
			sectionCode:$('#section').combobox('getValue'),
			subjectCode:$('#subject').combobox('getValue'),
		    teacherName:$('#userName').val().trim(),
		    orgName:$('#schoolName').val().trim(),
		}
	}
	function sectionChange(newValue, oldValue){
		sectionSubject(newValue,$('#subject'))
	}
	//导出
	function exportExcel(){
		var param=getParam();
		var url="/manage/courseAuthor/export.html?fileName="+getExportName();
		downloadHelper(urlWithParam(url,getParam()));
	}
	</script>
</body>
</html>