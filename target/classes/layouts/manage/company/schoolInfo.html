<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<#include "/manage/common/meta_js.html"/>
	<#include "/manage/common/meta_css.html"/>
	<script type="text/javascript"
	src="/manage/moveToCommon/js/knockout-easyui-Lite/knockout-easyui.js"></script>
	<title>学校信息</title>
	<style>
		.attrDiv400 .textbox{
			height: 30px !important;
		}
		.attrDiv400 .textbox .combo-arrow{
			height: 30px !important;
			width: 30px !important;
		}
		.updateBtn{
			margin-left: 733px;
		}
	</style>
</head>
<body>
<div style="padding:20px;height:100%">
		<div class="attrDiv400">
			<span><span class="red">*</span>学校名称：</span>
			<input data-bind="value:orgName"/>
		</div>
		<div class="attrDiv400">
			<span class="labelWidth60">学校简称：</span>
			<input data-bind="value:orgNameShort"/> 
		</div>

		<span class="clear15"></span>
		<div class="attrDiv400">
			<span ><span class="red">*</span>学段：</span>
			<input disabled data-bind="comboboxSource:section.source,comboboxValue:section.val,easyuiOptions:section.viewSettings"/>
		</div>
		<div class="attrDiv400">
			<span >联系人：</span><input data-bind="value:topName"/>
		</div>
	<!-- 	<div class="attrDiv400">
			<span class="labelWidth60">组织机构代码</span>
			<input data-bind="value:orgRegCode"/> 

		</div> -->
		<span class="clear15"></span>
		<div class="attrDiv400">
			<span >联系电话：</span>
			<input data-bind="value:phone"/>
		</div>
		<div class="attrDiv400">
			<span >电子邮箱：</span><input data-bind="value:mail"/>
		</div>
	<!-- 	<span class="clear15"></span>
		<form id="imageFm" enctype="multipart/form-data" method="post" action="/manage/company/uploadImage.html">
			<div class="attrDiv400">
			<span >学校LOGO：</span>
			<input id="file" name="file" type="file"/>
			<img id="image" class="upload" data-bind="attr:{src:path}" /> 
			<input 	hidden="hidden" id="fileType" name="fileType" value="company">
			</div>
		</form> -->
		<span class="clear50"></span>
		<div class="attrDiv850 ">
			<span >学校描述：</span>
			<textarea cols="100" rows="5" maxlength="500" data-bind="value:introduction"></textarea>
		</div>
		<span class="clear15"></span>
		<div class="updateBtn">
			<a class="btn btnConfirm" onclick="save()">更新</a>
		</div>
</div>
<script type="text/javascript">
	function school(org,sectionList){
		var self=this;
		this.orgName=ko.validatedObservable(org.orgName).extend({
			required:true
		});
		this.orgNameShort=ko.observable(org.orgNameShort);
		this.sectionName=ko.observable(org.sectionName);
		this.orgRegCode=ko.observable(org.orgRegCode);
		this.mail=ko.validatedObservable(org.mail).extend({
			email:{
				param:true,
				message:"邮箱格式不正确"
			}
		});
		this.phone=ko.validatedObservable(org.phone).extend({
			contact:{
				param:true,
				message:"联系电话格式不正确"
			}
		});
		this.topName=ko.validatedObservable(org.topName).extend({
			maxLength:20,	
		});
		this.orgCode=ko.observable(org.orgCode);
		this.path=ko.observable("${imageHost}/"+org.logoUrl);
		/* this.modifyTime=moment(org.modifyTime).format("YYYY-MM-DD  H:mm")||"暂无"; */
		this.introduction=ko.validatedObservable(org.introduction).extend({
			 maxLength:500
		});
		this.section={
				source:ko.observableArray(sectionList),
				val:ko.observable(org.sectionCode),
				viewSettings:{
					editable:false,
					textField:"name",
					valueField:"code",
					required:true,
				}
		}
	}
	var logoUrl=""
	$(function(){
		org=eval(${org})
		sectionList=eval(${sectionList});
		imageUpload($('#file'), $('#image'), function(path){logoUrl=path}) 
		model=new school(org,sectionList);
		ko.applyBindings(model);
	})
	
	//取消
	function cancel(){
		window.location.href=window.location.href;
	}
	//保存
	function save(){
		if(model.orgName==""){
			alert("机构名称不能为空");
			return false;
		}
		if(model.section.val()==""){
			alert("学段不能为空");
			return false;
		}
		if(ko.validation.group(model)().length>0){
			ko.validation.group(model).showAllMessages();
			return false;
		}
		var data={
				orgName:model.orgName(),
				orgNameShort:model.orgNameShort(),
				phone:model.phone(),
				mail:model.mail(),
				orgCode:model.orgCode(),
				sectionCode:model.section.val(),
				logoUrl:logoUrl||org.logoUrl,
				introduction:model.introduction(),
				topName:model.topName(),
		}
		$.ajax({
			url:'/manage/company/updateOrg.html',
			data:data,
			success:function(res){
				alert(res.msg)
			}
		})
		
	}
</script>
</body>
</html>