<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>编辑菜单</title>
<#include "/manage/common/meta_js.html"/>
<#include "/manage/common/meta_css.html"/>
</head>
<body>
    <div class="easyui-layout" data-options="fit:true">
	<form id="fm" method="post" style="padding: 20px" onsubmit="checkForm()">
	<div data-options="region:'center',border:false">
		<div class=attrDiv>
			<span class="labelWidth60">资源名称<span style="color: red">※</span>
			</span> <input id="name" class="easyui-validatebox" maxlength="20"
				data-options="validType:'length[0,20]',required:true"/> 
		</div>
		<div class="attrDiv">
			<span class="labelWidth60">资源URI</span><input
				id="uri" class="easyui-validatebox" maxlength="50"
				data-options="validType:'length[0,50]'"/>
		</div>
		<span class="clear" style="height: 10px"></span>
		<div class="attrDiv">
			<div class="labelWidth90">资源参数</div>
			<input id="param" name="param" class="easyui-validatebox"
				data-options="validType:'length[0,50]'" maxlength="50" />
		</div>
		<div class="attrDiv">
			<span style="width:90px;float:left">上层资源</span><input id="pid"
				class="easyui-combobox" style="width: 174px"
				data-options="valueField:'id',textField:'name',panelHeight: '180'"/>
		</div>
		<span class="clear" style="height: 10px"></span>
		<div class="attrDiv">
			<div style="width:90px;float:left">资源类型</div>
			<input id="type" name="type" class="easyui-combobox" style="width:174px"
				data-options="
					valueField: 'value',
					textField: 'label',
					panelHeight:'auto',
					data: [{
						label: '请选择',
						value: '0'
					},{
						label: '页面资源',
						value: '1'
					}],editable:false
		"/>
		</div>
		<div class="attrDiv">
			<div class="labelWidth90">排序顺序</div>
			<input id="dispOrder" name="dispOrder" class="easyui-validatebox" required="true" data-options="validType:'integer'">
		</div>
		<span class="clear" style="height:20px"></span>
		<div class="attrDiv650">
			<span class="labelWidth60">备&nbsp;&nbsp;注</span>
			<textarea id="memo" rows="5" cols="67" maxlength="100"
				class="easyui-validatebox" data-options="validType:'length[0,100]'"></textarea>
		</div>
		</div>
		<div data-options="region:'south',border:false" style="text-align: right; padding: 0 10px 10px 0"> 
				<a class="btn btnBlue" onclick="save()">保存</a>
				<a class="btn btnGrey" onclick="cancelAdd()" style="margin-left: 15px">关闭</a>
		</div>
	</form>
	</div>
	<script type="text/javascript">
	    var resource="";
		$(function() {
			<#if "${resource}" != "">
			    resource=$.parseJSON('${resource}');
			    $('#pid').combobox('setValue', resource.pid);
				$('#type').combobox('setValue', resource.type);
				$('#name').val(resource.name);
				$('#memo').val(resource.memo);
				$('#uri').val(resource.uri);
				$('#param').val(resource.param);
				$('#dispOrder').val(resource.dispOrder);
			<#else>
			    $('#type').combobox('setValue', '0');
			</#if>
			loadParentResource();
		})
	
	//加载上层资源信息
	function loadParentResource() {
		var type=1;
		var opts = {
			url : "/manage/menu/listPageRes.html",
			type : "POST",
			data : {
				type:type
			},
			success : function(data) {
				$('#pid').combobox('loadData', data);
				if("${pid}"!=""){
					$('#pid').combobox('setValue',"${pid}");
				}
			},
			error : function(XMLHttpRequest, textStatus, errorThrown) {
				alert("网络繁忙请稍后再试");
			}
		}
		$.ajax(opts);
	}

	//保存
	function save(){
			if ($('#fm').form('validate')) {
				var pid = $('#pid').combobox('getValue');
				var type = $('#type').combobox('getValue');
				var name=$('#name').val();
				var param=$('#param').val();
				var uri=$('#uri').val();
				var memo=$('#memo').val();
				var dispOrder=$('#dispOrder').val();
				var opts = {
					url : "/manage/menu/addMenu.html",
					type : "POST",
					data : {
						type:type,
				        pid:pid,
				        name:name,
				        param:param,
				        uri:uri,
				        dispOrder:dispOrder,
				        memo:memo
				        <#if "${isModify}" == true>
						,id:resource.id
					    </#if>
					},
					success : function(jsonStr) {
						var res=jsonStr;
						window.top.$.messager.alert("提示", res.msg, "info");
						if(res.success){
							easyui_closeTopWindow(true);
						}
					},
					error : function(XMLHttpRequest, textStatus, errorThrown) {
						alert("网络繁忙请稍后再试");
					},
					complete : function() {
						
					}
				}
				$.ajax(opts);
		}
		else{
				return $('#fm').form('validate');
		}
	}
	
	//取消操作
	function cancelAdd() {
		easyui_closeTopWindow(false);
	}
	
	//校验表单必填项是否有空值
	function checkForm(){
		var name=$("#name").val().trim();
		if(name==null||name==""){
			window.top.$.messager.alert("提示", "资源名称不能为空！", "info");
			return false;
		}
		return true;
	}
</script>
</body>
</html>