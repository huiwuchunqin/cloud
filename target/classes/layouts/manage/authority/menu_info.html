<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>菜单管理</title>
<#include "/manage/common/meta_js.html"/>
<#include "/manage/common/meta_css.html"/>
</head>
<body>
	<div id="bar" class="btnToolbar">
	    <a href="javascript:addMenu()" class="easyui-linkbutton" data-options="iconCls:'icon-add',plain:true">添加</a>
	    <div class="datagrid-btn-separator"></div>
		<a href="javascript:editMenu()" class="easyui-linkbutton" data-options="iconCls:'icon-edit',plain:true">修改</a>
		<div class="datagrid-btn-separator"></div>
		<a href="javascript:deleteMenu()" class="easyui-linkbutton" data-options="iconCls:'icon-remove',plain:true">删除</a>
	</div>
    <table id="menuTreeGrid" class="easyui-treegrid"
       data-options="idField:'id',
       treeField:'name',
       fit:true,
       rownumbers:true,
       toolbar:'#bar'
       ">
    <thead>
    	<tr>
    		<th data-options="field:'id',width:30,align:'center',halign:'center',hidden:true">资源编号</th>
    		<th data-options="field:'name',width:180,align:'left',halign:'center'">菜单资源名称</th>
    		<th data-options="field:'uri',width:250,align:'left',halign:'center'">菜单资源URI</th>
    		<th data-options="field:'dispOrder',width:250,align:'right',halign:'center'">排序顺序</th>
    		<th data-options="field:'type',width:80,align:'left',halign:'center',hidden:true">菜单资源类型</th>
    		<th data-options="field:'param',width:250,align:'left',halign:'center'">菜单资源参数</th>
    		<th data-options="field:'memo',width:320,align:'left',halign:'center'">备注</th>
    	</tr>
    </thead>
    </table>
	<script type="text/javascript">
	$(function(){
		$('#menuTreeGrid').treegrid({
			url:'/manage/menu/searchAll.html?parentId=0',
			onLoadSuccess:function(){
				$("#menuTreeGrid").treegrid('expandAll');
			}
		});
	})
	
	//添加菜单
	function addMenu() {
		var row=$('#menuTreeGrid').treegrid('getSelected');
		var pid=-1;
		if(row){
			pid=row.id;
		}
		easyui_openTopWindow("新增资源", 730, 430,
			"/manage/menu/menuAdd.html?pid="+pid, function(r) {
			    if(r){
				    $("#menuTreeGrid").treegrid('reload');
			    }
			});
	}
	
	//删除菜单
	function deleteMenu(){
		var row=$("#menuTreeGrid").treegrid('getSelected');
		if(row==null){
			$.messager.alert('系统提示','请先选择一个要删除的资源！','info');
			return;
		}
		var opts = {
				url : '/manage/menu/delete.html',
				data : {
					id: row.id,
				},
				success : function(json) {
					var res = json;
					$.messager.alert('信息', res.msg, 'info', function(r) {
						$("#menuTreeGrid").treegrid('reload');
					})
				},
				error : function(XMLHttpRequest, textStatus, errorThrown) {
					alert("网络繁忙请稍后再试");
				}
			}
			$.messager.confirm("提示", "确定删除该资源？", function(r) {
				if(r){
					$.ajax(opts);
				}
			});
		}
	
	//修改菜单
	function editMenu() {
		    var row=$('#menuTreeGrid').treegrid('getSelected');
		    if(row==null){
			   $.messager.alert('系统提示','请先选择一个要修改的菜单资源！','info');
			   return;
		    }
			easyui_openTopWindow("修改资源信息", 730, 430, "/manage/menu/menuEdit.html?id="
					+ row.id, function(r) {
				if(r){
					$("#menuTreeGrid").treegrid('reload');
				}
			});
	}
    </script>
</body>
</html>

