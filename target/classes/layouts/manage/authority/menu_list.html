<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>角色资源分配--资源信息列表</title>
<#include "/manage/common/meta_js.html"/>
<link rel="stylesheet" type="text/css" href="/manage/template/css/easyui/themes/bzt/easyui.css" />
<link rel="stylesheet" type="text/css" href="/manage/template/css/easyui/themes/icon.css" />
<link rel="stylesheet" type="text/css" href="/manage/template/css/customer.css" />
</head>
<body class="easyui-layout">
	<div data-options="region:'north'" style="height: 26px;">
		<span style="margin-left: 5px;">角色名称:<font color="red">${role.name}</font></span>
	</div>
	<div data-options="region:'center',title:'资源列表'" title="资源列表"
		id="layout-resourceList" oncontextmenu="return false;">
		<div style="margin-top: 10px; margin-left: 30px;">
			<ul id="tree" class="easyui-tree" checkbox="true">
			</ul>
		</div>
	</div>
	<div data-options="region:'south'"
		style="height:50px;padding:10px;text-align:right;">
		<a class="btn btnBlue" onclick="save()" >保存</a>
		<a class="btn btnGrey" onclick="cancelAdd()" style="margin-left:10px;">关闭</a>
	</div>
	<script type="text/javascript">
	var isSaveing=false;
		$(function() {
			var opts = {
				url : '/manage/roleResource/getResource.html',
				data : {
					roleId : "${role.id}"
				},
				success : function(json) {
					$('#tree').tree({
						data : json
					});
				}
			}
			$.ajax(opts);
		})
		
		//取消操作
		function cancelAdd() {
			easyui_closeTopWindow();
		}
		
		//为角色批量分配资源
		function save() {
			var parentNodes = $('#tree').tree('getChecked', 'indeterminate');//获取父资源节点
			var childNodes = $('#tree').tree('getChecked');//获取子资源节点
			var resIds = new Array();
			for (var i = 0; i < parentNodes.length; i++) {
				resIds.push(parentNodes[i].id);
			}
			for (var j = 0; j < childNodes.length; j++) {
				resIds.push(childNodes[j].id)
			}
			if (resIds.length == 0) {
				$.messager.alert("提示", "请先选择要分配的资源");
			} else {
				var arrResourceCode = resIds.join(",");
				var opts = {
					url : "/manage/roleResource/addRoleResource.html",
					type : "POST",
					data : {
						resourceCode : arrResourceCode,
						roleId : "${role.id}"
					},
					success : function(jsonStr) {
						var res = jsonStr;
						window.top.$.messager.alert("提示", res.msg, "info");
						easyui_closeTopWindow();
					},
					error : function(XMLHttpRequest, textStatus, errorThrown) {
						alert("网络繁忙请稍后再试");
					},
					complete : function() {
                        
					},
				}
				if(!isSaveing){
					$.ajax(opts);
					isSaveing=true;
				}else{
					$.messager.alert("提示","数据正在保存中,请耐心等候","info");
				}
			}
		}
	</script>
</body>
</html>

